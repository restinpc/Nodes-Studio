/* Nodes Studio 3.0.0.1 script. 15/02/2019 */
function clamp(a,b,c){return Math.min(c,Math.max(a,b))}function mod(a,b){return(a%b+b)%b}function copyPixelNearest(a,b){const{width:c,height:d,data:e}=a,f=(a,b)=>4*(b*c+a);return(a,g,h)=>{const i=f(clamp(Math.round(a),0,c-1),clamp(Math.round(g),0,d-1));for(let c=0;3>c;c++)b.data[h+c]=e[i+c]}}function copyPixelBilinear(a,b){const{width:c,height:d,data:e}=a,f=(a,b)=>4*(b*c+a);return(a,g,h)=>{const i=clamp(Math.floor(a),0,c-1),j=clamp(Math.ceil(a),0,c-1),k=a-i,l=clamp(Math.floor(g),0,d-1),m=clamp(Math.ceil(g),0,d-1),n=g-l,o=f(i,l),p=f(j,l),q=f(i,m),r=f(j,m);for(let c=0;3>c;c++){const a=e[o+c]*(1-k)+e[p+c]*k,d=e[q+c]*(1-k)+e[r+c]*k;b.data[h+c]=Math.ceil(a*(1-n)+d*n)}}}function kernelResample(a,b,c,d){const{width:e,height:f,data:g}=a,h=(a,b)=>4*(b*e+a),k=2*c,l=[,,,,],m=[,,,,];return(a,j,n)=>{const i=Math.floor(a),o=Math.floor(j),p=i-c+1,q=o-c+1;for(let b=0;b<k;b++)l[b]=d(a-(p+b)),m[b]=d(j-(q+b));for(let c,d=0;3>d;d++){c=0;for(let a=0;a<k;a++){const b=q+a,i=clamp(b,0,f-1);let n=0;for(let a=0;a<k;a++){const b=p+a,c=h(clamp(b,0,e-1),i);n+=g[c+d]*l[a]}c+=n*m[a]}b.data[n+d]=Math.round(c)}}}function copyPixelBicubic(a,c){const d=-.5;return kernelResample(a,c,2,a=>{a=Math.abs(a);const b=a*a,c=a*a*a;return 1>=a?(d+2)*c-(d+3)*b+1:d*c-5*d*b+-4*a- -2})}function copyPixelLanczos(a,b){const c=5;return kernelResample(a,b,5,a=>{if(0===a)return 1;else{const b=Math.PI*a;return c*Math.sin(b)*Math.sin(b/c)/(b*b)}})}const orientations={pz:(a,b,c)=>{a.x=-1,a.y=-b,a.z=-c},nz:(a,b,c)=>{a.x=1,a.y=b,a.z=-c},px:(a,b,c)=>{a.x=b,a.y=-1,a.z=-c},nx:(a,b,c)=>{a.x=-b,a.y=1,a.z=-c},py:(a,b,c)=>{a.x=-c,a.y=-b,a.z=1},ny:(a,b,c)=>{a.x=c,a.y=-b,a.z=-1}};function renderFace({data:a,face:b,rotation:c,interpolation:d,maxWidth:e=1/0}){const f=Math.min(e,a.width/4),g=f,h={},i=orientations[b],j=new ImageData(f,g),k="linear"===d?copyPixelBilinear(a,j):"cubic"===d?copyPixelBicubic(a,j):"lanczos"===d?copyPixelLanczos(a,j):copyPixelNearest(a,j);for(let l=0;l<f;l++)for(let b=0;b<g;b++){const d=4*(b*f+l);j.data[d+3]=255,i(h,2*(l+.5)/f-1,2*(b+.5)/g-1);const e=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z),m=mod(Math.atan2(h.y,h.x)+c,2*Math.PI),n=Math.acos(h.z/e);k(a.width*m/Math.PI/2-.5,a.height*n/Math.PI-.5,d)}postMessage(j)}onmessage=function({data:a}){renderFace(a)};