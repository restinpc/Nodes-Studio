/* Nodes Studio 2.0.8 uploader script. 02-04-2018 */
function addHandler(e,t,n,d){e.addEventListener?e.addEventListener(t,n,d||!1):e.attachEvent?e.attachEvent("on"+t,n):alert("Add handler is not supported")}function drag(e){if(!e)e=window.event;e.pageX||e.pageY?(posx=e.pageX,posy=e.pageY):(e.clientX||e.clientY)&&(posx=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,posy=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);try{var t=e.changedTouches[0];posx=parseInt(t.clientX),posy=parseInt(t.clientY)}catch(e){}if(1==drag_mode)0==fx&&(fx=posx-parseInt(document.getElementById("frame").style.left)),0==fy&&(fy=posy-parseInt(document.getElementById("frame").style.top)),posx-=fx,posy-=fy,posx>document.getElementById("img").clientWidth-document.getElementById("frame").clientWidth+34&&(posx=document.getElementById("img").clientWidth-document.getElementById("frame").clientWidth+34),posy>document.getElementById("img").clientHeight-document.getElementById("frame").clientHeight+34&&(posy=document.getElementById("img").clientHeight-document.getElementById("frame").clientHeight+34),posy<34&&(posy=34),posx<34&&(posx=34),document.getElementById("frame").style.left=posx-6+"px",document.getElementById("frame").style.top=posy-6+"px",document.getElementById("t").value=posy-32,document.getElementById("l").value=posx-32;else if(2==drag_mode){var n=posx-parseInt(document.getElementById("frame").style.left);n+parseInt(document.getElementById("frame").style.left)>document.getElementById("img").clientWidth+24&&(n=document.getElementById("img").clientWidth-parseInt(document.getElementById("frame").style.left)+24);var d=n*(twidth/theight);n-26<=document.getElementById("img").clientWidth-parseInt(document.getElementById("frame").style.left)&&d-26<=document.getElementById("img").clientHeight-parseInt(document.getElementById("frame").style.top)&&d>=theight/2&&n>=twidth/2&&(width=n+4,height=d+4,document.getElementById("frame").style.width=width+"px",document.getElementById("frame").style.height=height+"px",document.getElementById("w").value=width,document.getElementById("h").value=height)}else fx=0,fy=0}function submit_img(){confirm(confirm_upload)&&document.getElementById("form").submit()}function load(){document.getElementById("img").clientHeight<height?(height=document.getElementById("img").clientHeight,width=parseInt(twidth/theight*height)):document.getElementById("img").clientWidth<width&&(width=document.getElementById("img").clientWidth,height=parseInt(theight/twidth*width)),document.getElementById("frame").style.width=width,document.getElementById("frame").style.height=height,document.getElementById("frame").style.display="block"}function undrag(){drag_mode=0}function $id(e){return document.getElementById(e)}function FileDragHover(e){e.stopPropagation(),e.preventDefault(),e.target.className="dragover"==e.type?"hover":""}function FileSelectHandler(e){FileDragHover(e);for(var t,n=e.target.files||e.dataTransfer.files,d=0;t=n[d];d++)ParseFile(t)}function ParseFile(e){if(0==e.type.indexOf("image")){var t=new FileReader;t.onload=function(t){UploadFile(e)},t.readAsDataURL(e)}}function UploadFile(e){if(!(location.host.indexOf("sitepointstatic")>=0)&&""==$id("fileselect").value){var t=new XMLHttpRequest;if(t.upload&&("image/jpeg"==e.type||"image/jpg"==e.type||"image/gif"==e.type||"image/png"==e.type)){var n=e.name;console.log(n),t.onreadystatechange=function(e){4==t.readyState&&("error"==t.responseText?(document.getElementById("fileselect").style.display="block",document.getElementById("filedrag").style.display="none",alert(no_drag_drop)):(document.getElementById("new_image").value=t.responseText,document.getElementById("new_image_form").submit()))},t.open("POST",dir+"/uploader.php?dragndrop=1",!0),t.setRequestHeader("X-FILENAME",e.name),t.setRequestHeader("X_FILENAME",e.name),t.setRequestHeader("HTTP_X_FILENAME",e.name),t.send(e),document.getElementById("filedrag").innerHTML=uploading+"..",console.log("done")}}}function Init(){var e=$id("fileselect"),t=$id("filedrag"),n=$id("submitbutton");e.addEventListener("change",FileSelectHandler,!1),(new XMLHttpRequest).upload&&(t.addEventListener("dragover",FileDragHover,!1),t.addEventListener("dragleave",FileDragHover,!1),t.addEventListener("drop",FileSelectHandler,!1),t.style.display="block",n.style.display="none")}post_new_image&&(addHandler(window,"load",load),addHandler(window,"touchmove",drag),addHandler(window,"mousemove",drag),addHandler(window,"mouseup",undrag),addHandler(top,"mouseup",undrag),addHandler(window,"dblclick",submit_img));